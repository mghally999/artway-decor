---
import categories from "@/config/projectCategories.json";
import projectsIndex from "@/config/projectsIndex.json";
import BunnyGallery from "@/components/BunnyGallery.astro";

export function getStaticPaths() {
  const paths = [];
  for (const c of categories) {
    const items = projectsIndex[c.slug] || [];
    for (const p of items) {
      paths.push({ params: { category: c.slug, project: p } });
    }
  }
  return paths;
}

const { category, project } = Astro.params;

const title = String(project)
  .replace(/-/g, " ")
  .replace(/\b\w/g, (m) => m.toUpperCase());
---

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{title}</title>
  </head>

  <body>
    <main class="wrap">
      <a class="back" href={`/projects/${category}`}>← Back</a>

      <h1>{title}</h1>
      <p class="sub">{category}</p>

      <!-- ✅ The grid container where images will go -->
      <div class="grid" id="galleryGrid"></div>
      
      <!-- ✅ Render the gallery component -->
      <BunnyGallery category={category} project={project} gridId="galleryGrid" />
    </main>

    <style>
      :root{
        --bg:#0b0d10;
        --text:#f5f7fb;
        --muted: rgba(245,247,251,.65);
        --tile: rgba(255,255,255,.04);
        --tileBorder: rgba(255,255,255,.10);
      }
      *{ box-sizing:border-box; }
      html,body{ margin:0; padding:0; background:var(--bg); color:var(--text); }
      a{ color:inherit; }

      .wrap{
        max-width:1200px;
        margin:0 auto;
        padding:40px 16px;
        font-family: system-ui;
      }
      @media (max-width: 760px){ .wrap{ padding:28px 14px; } }

      .back{
        display:inline-block;
        margin-bottom:14px;
        text-decoration:none;
        opacity:.8;
      }
      .back:hover{ opacity:1; }

      h1{ font-size:34px; margin:0; }

      .sub{
        margin:8px 0 18px;
        color: var(--muted);
        text-transform: uppercase;
        letter-spacing:.08em;
        font-size:12px;
      }

      /* ✅ NEW: Fluid grid with no gaps, stretches to container */
      .grid{
        display:grid;
        grid-template-columns: repeat(3, 1fr); /* Equal width columns */
        width:100%;
        gap: 30px;
      }

      /* Card styles - now fluid to fill grid cells */
      .card{
        display:block;
        width:100%;
        height:100%;
        text-decoration:none;
        padding:0; /* Remove any padding */
      }

      .thumb{
        width:100%;
        height:382px; /* Fixed height but width is fluid */
        border-radius:18px;
        overflow:hidden;
        background: var(--tile);
        border: 1px solid var(--tileBorder);
      }

      .img{
        width:100%;
        height:100%;
        object-fit:cover;
        display:block;
      }

      .meta{ 
        padding-top:14px;
        padding-bottom:14px;
      }
      .meta h3{ margin:0 0 8px; font-size:20px; font-weight:700; color:var(--text); }
      .meta p{ margin:0; color: var(--muted); line-height:1.5; }

      /* ✅ Responsive - same as categories page but no gaps */
      @media (max-width:1180px){
        .grid{ grid-template-columns: repeat(2, 1fr); }
      }
      @media (max-width:760px){
        .grid{ grid-template-columns: 1fr; }
      }
    </style>
  </body>
</html>